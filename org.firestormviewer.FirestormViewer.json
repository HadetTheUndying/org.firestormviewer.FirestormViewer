{
  "app-id":"org.firestormviewer.FirestormViewer",
  "runtime":"org.freedesktop.Platform",
  "runtime-version":"20.08",
  "sdk":"org.freedesktop.Sdk",
  "command":"firestorm-viewer",
  "separate-locales":false,
  "finish-args":[
    "--share=ipc",
    "--socket=x11",
    "--socket=pulseaudio",
    "--share=network",
    "--allow=multiarch",
    "--device=dri",
    "--filesystem=~/.firestorm_x64",
    "--filesystem=xdg-desktop",
    "--filesystem=xdg-documents",
    "--filesystem=xdg-download",
    "--filesystem=xdg-music",
    "--filesystem=xdg-pictures",
    "--filesystem=xdg-run/app/com.discordapp.Discord:create",
    "--talk-name=org.freedesktop.Notifications",
    "--own-name=com.secondlife.ViewerAppAPIService"
  ],
  "cleanup":[
    "/share/man",
    "/share/doc",
    "/share/gtk-doc",
    "/lib/pkgconfig",
    "/lib/debug"
  ],
  "build-options":{
    "strip":true
  },
  "add-extensions":{
    "org.freedesktop.Platform.Compat.i386":{
      "directory":"lib/i386-linux-gnu",
      "version":"20.08"
    }
  },
  "sdk-extensions":[
    "org.freedesktop.Sdk.Compat.i386",
    "org.freedesktop.Sdk.Extension.toolchain-i386"
  ],
  "modules":[
    "shared-modules/glu/glu-9.json",
    "shared-modules/gtk2/gtk2.json",
    "shared-modules/dbus-glib/dbus-glib-0.110.json",
    {
      "name":"wine",
      "build-options":{
        "make-args":[
          "--silent"
        ],
        "arch":{
          "x86_64":{
            "prepend-pkg-config-path":"/app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig",
            "ldflags":"-L/app/lib32",
            "append-path":"/usr/lib/sdk/toolchain-i386/bin",
            "env":{
              "CC":"i686-unknown-linux-gnu-gcc",
              "CXX":"i686-unknown-linux-gnu-g++"
            },
            "libdir":"/app/lib32"
          }
        }
      },
      "config-opts": [
        "--without-vkd3d",
        "--without-xinput",
        "--without-xinput2"
      ],
      "sources":[
        {
          "type":"archive",
          "url":"https://dl.winehq.org/wine/source/5.x/wine-5.21.tar.xz",
          "sha256":"5a1a5c2549d11bce0d6640220ed6fd31042afcbcb366f475e0ccb4781d2d2840"
        }
      ]
    },
    {
      "name":"libnotify",
      "buildsystem":"meson",
      "config-opts":[
        "-Ddocbook_docs=disabled",
        "-Dintrospection=disabled",
        "-Dtests=false",
        "-Dgtk_doc=false",
        "-Dman=false"
      ],
      "cleanup":[
        "/bin"
      ],
      "sources":[
        {
          "type":"archive",
          "url":"https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.9.tar.xz",
          "sha256":"66c0517ed16df7af258e83208faaf5069727dfd66995c4bbc51c16954d674761"
        }
      ]
    },
    {
      "name":"firestorm",
      "buildsystem":"simple",
      "sources":[
        {
          "type":"extra-data",
          "filename":"viewer.tar.xz",
          "url":"https://downloads.firestormviewer.org/linux/Phoenix_Firestorm-Releasex64_x86_64_6.3.9.58205.tar.xz",
          "sha256":"c892db56570fa61f30c9322b77ec8a4d9431ca08eb16a1d0159a19bad32f44bd",
          "size": 158766256
        },
        {
          "type": "script",
          "dest-filename": "apply_extra",
          "commands": [
            "tar -xf viewer.tar.xz --strip 1 --no-same-owner",
            "rm viewer.tar.xz",
            "cp /app/etc/launch_url.sh etc/"
          ]
        },
        {
          "type":"file",
          "path":"assets/firestorm-viewer"
        },
        {
          "type":"file",
          "path":"assets/launch_url.sh"
        },
        { 
          "type":"file",
          "path":"assets/org.firestormviewer.FirestormViewer.desktop"
        },
        {
          "type":"file",
          "path":"assets/org.firestormviewer.FirestormViewer.metainfo.xml"
        },
        {
          "type":"file",
          "url":"https://vcs.firestormviewer.org/phoenix-firestorm-lgpl/raw/5e2050564bd3730f0ce7843860afdb25da3d2346/indra/newview/res/firestorm_icon.png",
          "sha256": "f51c4c1609d6fe1a75914f3644888816525524e641c2f2821436993921800390",
          "dest-filename": "org.firestormviewer.FirestormViewer.png"
        }
      ],
      "build-commands":[
        "install apply_extra /app/bin/",
        "install launch_url.sh /app/etc/",
        "install -Dm755 firestorm-viewer $FLATPAK_DEST/bin/",
        "install -Dm644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop",
        "install -Dm644 $FLATPAK_ID.png $FLATPAK_DEST/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png",
        "install -Dm644 $FLATPAK_ID.metainfo.xml $FLATPAK_DEST/share/metainfo/$FLATPAK_ID.metainfo.xml",
        "mkdir $FLATPAK_DEST/lib/i386-linux-gnu"
      ]
    }
  ]
}
