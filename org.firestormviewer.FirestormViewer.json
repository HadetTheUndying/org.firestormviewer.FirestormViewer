{
  "app-id":"org.firestormviewer.FirestormViewer",
  "runtime":"org.freedesktop.Platform",
  "runtime-version":"19.08",
  "sdk":"org.freedesktop.Sdk",
  "command":"firestorm-viewer",
  "separate-locales":false,
  "finish-args":[
    "--share=ipc",
    "--socket=x11",
    "--socket=pulseaudio",
    "--share=network",
    "--allow=multiarch",
    "--device=dri",
    "--filesystem=home",
    "--talk-name=org.freedesktop.Notifications",
    "--own-name=com.secondlife.ViewerAppAPIService",
    "--filesystem=xdg-run/app/com.discordapp.Discord:create"
  ],
  "cleanup":[
    "/share/man",
    "/share/doc",
    "/share/gtk-doc",
    "/lib/pkgconfig",
    "/lib/debug"
  ],
  "build-options":{
    "strip":true
  },
  "add-extensions":{
    "org.freedesktop.Platform.Compat.i386":{
      "directory":"lib/i386-linux-gnu",
      "version":"19.08"
    }
  },
  "sdk-extensions":[
    "org.freedesktop.Sdk.Compat.i386",
    "org.freedesktop.Sdk.Extension.toolchain-i386"
  ],
  "modules":[
    "shared-modules/glu/glu-9.json",
    "shared-modules/gtk2/gtk2.json",
    "shared-modules/dbus-glib/dbus-glib-0.110.json",
    {
      "name":"wine",
      "build-options":{
        "make-args":[
          "--silent"
        ],
        "arch":{
          "x86_64":{
            "prepend-pkg-config-path":"/app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig",
            "ldflags":"-L/app/lib32",
            "append-path":"/usr/lib/sdk/toolchain-i386/bin",
            "env":{
              "CC":"i686-unknown-linux-gnu-gcc",
              "CXX":"i686-unknown-linux-gnu-g++"
            },
            "libdir":"/app/lib32"
          }
        }
      },
      "config-opts": [
        "--without-vkd3d",
        "--without-xinput",
        "--without-xinput2"
      ],
      "sources":[
        {
          "type":"archive",
          "url":"https://dl.winehq.org/wine/source/4.x/wine-4.21.tar.xz",
          "sha256":"324ce14a70059835f33d293f0740b1bf0366bc6b5514548bc083d89b44744ad0"
        },
        {
          "type":"archive",
          "url":"https://github.com/wine-staging/wine-staging/archive/v4.21.tar.gz",
          "sha256":"6b1e2803ea81d918a1f4cd49dddab0e89d39d8762f0e357e296a379fe3fb9960"
        },
        {
          "type":"shell",
          "commands":[
            "./patches/patchinstall.sh DESTDIR=$(pwd) --all"
          ]
        }
      ]
    },
    {
      "name":"libnotify",
      "config-opts":[
        "--disable-static",
        "--disable-tests",
        "--disable-introspection"
      ],
      "cleanup":[
        "/bin"
      ],
      "sources":[
        {
          "type":"archive",
          "url":"https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.7.tar.xz",
          "sha256":"9cb4ce315b2655860c524d46b56010874214ec27e854086c1a1d0260137efc04"
        }
      ]
    },
    {
      "name":"firestorm",
      "buildsystem":"simple",
      "cleanup":"viewer.tar.xz",
      "sources":[
        {
          "type":"extra-data",
          "filename":"viewer.tar.xz",
          "url":"http://downloads.firestormviewer.org/linux/Phoenix_Firestorm-Releasex64_x86_64_6.3.2.58052.tar.xz",
          "sha256":"c80e16541697aa32925781b28cd58545645cb5a2a814d5f296a39a73a03d38c1",
          "size": 158113392
        },
        {
          "type": "script",
          "dest-filename": "apply_extra",
          "commands": [
            "tar -xf viewer.tar.xz --strip 1 --no-same-owner",
            "rm viewer.tar.xz",
            "cp /app/etc/launch_url.sh etc/"
          ]
        },
        {
          "type":"file",
          "path":"assets/firestorm-viewer"
        },
        {
          "type":"file",
          "path":"assets/launch_url.sh"
        },
        { 
          "type":"file",
          "path":"assets/org.firestormviewer.FirestormViewer.desktop"
        },
        {
          "type":"file",
          "path":"assets/org.firestormviewer.FirestormViewer.metainfo.xml"
        },
        {
          "type":"file",
          "url":"https://vcs.firestormviewer.org/phoenix-firestorm-release/raw/381d04b870a59ef98cc442a5d4aeb6b38cfdbed7/indra/newview/icons/release/firestorm_512.png",
          "sha256": "524cf9af9817e9df5afd16c83599349287de63febe42d9874992ab523d8e08f7",
          "dest-filename": "org.firestormviewer.FirestormViewer.png"
        }
      ],
      "build-commands":[
        "install apply_extra /app/bin/",
        "install launch_url.sh /app/etc/",
        "install -Dm755 firestorm-viewer $FLATPAK_DEST/bin/",
        "install -Dm644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop",
        "install -Dm644 $FLATPAK_ID.png $FLATPAK_DEST/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png",
        "install -Dm644 $FLATPAK_ID.metainfo.xml $FLATPAK_DEST/share/metainfo/$FLATPAK_ID.metainfo.xml",
        "mkdir $FLATPAK_DEST/lib/i386-linux-gnu"
      ]
    }
  ]
}
